<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VPizde Journal</title>
    <style>
        /* CSS RESET */
        * {
            box-sizing: border-box;
        }

        /* –¶–≤–µ—Ç–∞ */
        :root {
            --dark-bg: #1A1A1A;
            --dark-card: #212121;
            --text-light: #D8D8D8;
            --text-secondary: #8C8C8C;
            --accent-white: #FFFFFF;
            --border-color: #333333;
            --accent-color: #55a8ff; 
            --like-color: #ff4757;
        }

        /* –û–±—â–∏–µ —Å—Ç–∏–ª–∏ */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", sans-serif;
            background-color: var(--dark-bg);
            color: var(--text-light);
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column; 
            min-height: 100vh;
        }

        .container {
            width: 100%;
            max-width: 1200px;
            padding: 0 10px; 
            margin: 0 auto;
        }

        /* 1. –®–∞–ø–∫–∞/–ù–∞–≤–∏–≥–∞—Ü–∏—è */
        .header {
            background-color: var(--dark-card);
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border-color);
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .logo-group {
            display: flex;
            align-items: center;
            flex-shrink: 0; 
            margin-right: 20px;
        }

        .logo-group img {
            height: 30px; 
            margin-right: 10px;
            cursor: pointer; 
        }

        .header-actions {
            flex-grow: 1; 
            display: flex;
            justify-content: flex-end;
            align-items: center;
        }

        .search-container {
            position: relative;
            max-width: 400px;
            width: 100%;
            margin-left: auto; 
        }

        #search-input {
            width: 100%;
            padding: 8px 10px 8px 40px; 
            border: none;
            border-radius: 4px;
            background-color: var(--dark-bg); 
            color: var(--text-light);
            font-size: 14px;
            transition: background-color 0.2s;
        }

        #search-input:focus {
            background-color: #2b2b2b;
            outline: none;
        }

        .search-icon {
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            width: 20px;
            height: 20px;
            object-fit: contain; /* –ß—Ç–æ–±—ã —Ñ–æ—Ç–æ –Ω–µ –∏—Å–∫–∞–∂–∞–ª–æ—Å—å */
        }

        /* 2. –û—Å–Ω–æ–≤–Ω–æ–π –º–∞–∫–µ—Ç */
        .main-content-wrap { 
            margin-bottom: 20px;
            width: 100%; 
        }

        .main-layout {
            display: flex;
            gap: 40px;
            margin-top: 20px;
        }

        .content {
            flex: 2.5;
            min-width: 0;
        }

        .sidebar {
            flex: 1;
            min-width: 300px;
        }

        /* 3. –°—Ç–∏–ª—å –ø–æ—Å—Ç–∞ –≤ –ª–µ–Ω—Ç–µ */
        .post {
            background-color: var(--dark-card);
            padding: 30px;
            margin-bottom: 30px;
            border-radius: 4px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            display: flex; 
            gap: 30px;
            cursor: pointer; 
        }

        .post:hover {
            opacity: 0.9;
            transition: opacity 0.2s;
        }

        .post-media {
            flex-shrink: 0; 
            width: 250px; 
            height: 150px;
            background-color: var(--border-color);
            border-radius: 4px;
            overflow: hidden;
        }

        .post-media img {
            width: 100%;
            height: 100%;
            object-fit: contain; 
        }

        .post-body-wrap {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .post-meta {
            font-size: 13px;
            color: var(--text-secondary);
            margin-bottom: 10px;
        }

        .post-meta a {
            color: var(--text-secondary);
            text-decoration: none;
        }

        .post-title {
            margin: 0 0 10px 0;
        }

        .post-title a {
            color: var(--accent-white);
            text-decoration: none;
            font-size: 28px;
            font-weight: bold;
            display: block;
        }

        .post-title a:hover {
            color: var(--accent-color);
        }

        .post-intro {
            line-height: 1.6;
            margin-bottom: 20px;
            color: var(--text-light);
            flex-grow: 1; 
        }

        .post-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 14px;
            color: var(--text-secondary);
            border-top: 1px dashed var(--border-color);
            padding-top: 15px;
        }

        .post-stats {
            display: flex;
            align-items: center;
        }

        .post-stats span {
            margin-right: 15px;
            display: flex;
            align-items: center;
        }

        .post-tags a {
            color: var(--text-secondary);
            text-decoration: none;
            margin-right: 10px;
            border: 1px solid var(--border-color);
            padding: 3px 8px;
            border-radius: 3px;
            font-size: 12px;
        }

        /* 4. –°—Ç–∏–ª–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å—Ç–∞—Ç—å–∏ –∏ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Å—Ç—Ä–∞–Ω–∏—Ü */
        .article-view {
            background-color: var(--dark-card);
            padding: 40px;
            border-radius: 4px;
            margin-bottom: 30px;
        }

        .article-cover {
            width: 100%;
            max-height: 450px;
            overflow: hidden;
            margin-bottom: 30px;
            border-radius: 4px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .article-cover img {
            width: 100%;
            height: 100%;
            object-fit: contain; 
        }

        .article-body p, .static-page-body p {
            line-height: 1.7;
            font-size: 17px;
            margin-bottom: 20px;
        }

        .static-page-body ul {
            margin-bottom: 20px;
            padding-left: 20px;
        }

        .static-page-body li {
            margin-bottom: 10px;
            line-height: 1.6;
        }

        /* –ö–Ω–æ–ø–∫–∞ –ª–∞–π–∫–∞ –≤ —Å—Ç–∞—Ç—å–µ */
        .article-like-btn {
            background-color: var(--dark-bg);
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: all 0.2s;
        }

        .article-like-btn:hover {
            border-color: var(--like-color);
            color: var(--text-light);
        }

        .article-like-btn.liked {
            color: var(--like-color);
            border-color: var(--like-color);
            background-color: rgba(255, 71, 87, 0.1);
        }

        .article-share-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            padding: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            transition: all 0.2s;
            margin-left: 10px;
        }

        .article-share-btn:hover {
            color: var(--accent-color);
        }

        .article-share-btn svg {
            width: 20px;
            height: 20px;
            fill: currentColor;
        }

        .toast-notification {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background-color: var(--dark-card);
            color: var(--text-light);
            padding: 15px 25px;
            border-radius: 8px;
            border: 1px solid var(--accent-color);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }

        .toast-notification.show {
            opacity: 1;
        }

        .loader-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--dark-bg);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        .loader-overlay.hidden {
            opacity: 0;
            visibility: hidden;
        }

        .loader-content {
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 30px;
        }

        .loader-pulse {
            width: 120px;
            height: 120px;
            animation: pulse-scale 1.5s ease-in-out infinite;
        }

        .loader-pulse img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        @keyframes pulse-scale {
            0% {
                transform: scale(0.8);
                opacity: 1;
            }
            50% {
                transform: scale(1.1);
                opacity: 0.8;
            }
            100% {
                transform: scale(0.8);
                opacity: 1;
            }
        }

        .loader-text {
            color: var(--text-secondary);
            font-size: 14px;
            letter-spacing: 2px;
            animation: dots 1.5s steps(4, end) infinite;
        }

        @keyframes dots {
            0%, 20% { content: ""; }
            40% { content: "."; }
            60% { content: ".."; }
            80%, 100% { content: "..."; }
        }

        /* 5. –°—Ç–∏–ª–∏ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω */
        .modal {
            display: none; 
            position: fixed;
            z-index: 20;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.7);
        }

        .modal-content {
            background-color: var(--dark-card);
            margin: 10% auto;
            padding: 30px;
            border: 1px solid var(--border-color);
            width: 80%;
            max-width: 600px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
        }

        /* –£–≤–µ–ª–∏—á–µ–Ω–Ω—ã–π —Ä–∞–∑–º–µ—Ä –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è */
        #managePostsModal .modal-content {
            max-width: 800px;
            margin: 5% auto;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è —Å–ø–∏—Å–∫–∞ —Å—Ç–∞—Ç–µ–π –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è */
        .post-management-list {
            list-style: none;
            padding: 0;
        }

        .post-management-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .post-management-item:last-child {
            border-bottom: none;
        }

        .post-management-title {
            flex-grow: 1;
            margin-right: 15px;
        }

        .management-actions button {
            background-color: var(--accent-color);
            color: white;
            padding: 5px 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            margin-left: 5px;
            transition: background-color 0.2s;
        }

        .management-actions .delete-btn {
            background-color: var(--like-color);
        }

        .management-actions .edit-btn:hover {
            background-color: #4a90e2;
        }

        .management-actions .delete-btn:hover {
            background-color: #cc3744;
        }

        .close-btn {
            color: var(--text-secondary);
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        /* –°—Ç–∏–ª–∏ —Ñ–æ—Ä–º—ã */
        .modal-content input[type="text"],
        .modal-content input[type="password"],
        .modal-content input[type="file"],
        .modal-content textarea {
            width: 100%;
            padding: 10px;
            margin: 8px 0 15px 0;
            display: inline-block;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            box-sizing: border-box;
            background-color: var(--dark-bg);
            color: var(--text-light);
        }

        .modal-content label {
            display: block;
            margin-top: 10px;
            color: var(--text-light);
        }

        .checkbox-group { 
            display: flex;
            align-items: center;
            margin: 15px 0;
        }

        .checkbox-group input[type="checkbox"] {
            width: auto;
            margin-right: 10px;
        }

        #publish-btn, #auth-btn, #save-edit-btn {
            background-color: var(--accent-color);
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin-top: 10px;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è —Å—Ç–∞—Ç–µ–π –≤ —Å–∞–π–¥–±–∞—Ä–µ */
        .popular-list a {
            display: block;
            margin-bottom: 10px;
            font-size: 14px;
            color: var(--text-light);
            text-decoration: none;
        }

        .popular-list a:hover {
            color: var(--accent-color);
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è "–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ" */
        .not-found {
            text-align: center;
            padding: 50px 0;
        }

        .not-found img {
            max-width: 300px;
            height: auto;
            margin-bottom: 20px;
        }

        /* 6. –°—Ç–∏–ª–∏ –ø–æ–¥–≤–∞–ª–∞ */
        .footer {
            background-color: var(--dark-card);
            color: var(--text-secondary);
            padding: 30px 20px;
            margin-top: 50px; 
            border-top: 1px solid var(--border-color);
            font-size: 14px;
            text-align: center;
            flex-shrink: 0; 
        }

        .footer a {
            color: var(--accent-color);
            text-decoration: none;
            margin: 0 10px;
        }

        .footer a:hover {
            text-decoration: underline;
        }

        /* NEW YEAR THEME */
        body.new-year-theme {
            background: linear-gradient(135deg, #0a1a2e 0%, #1a3a52 100%) !important;
            background-attachment: fixed !important;
        }

        body.new-year-theme::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #0a1a2e 0%, #1a3a52 100%);
            z-index: 0;
            pointer-events: none;
        }

        body.new-year-theme .dark-bg {
            --dark-bg: #0f2640;
        }

        /* Snow animation */
        .snowflakes {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
            overflow: hidden;
        }

        .snowflake {
            position: absolute;
            top: -10px;
            color: #fff;
            font-size: 1.5em;
            text-shadow: 0 0 5px rgba(255, 255, 255, 0.8);
            animation: snowfall linear infinite;
            opacity: 0.8;
        }

        @keyframes snowfall {
            to {
                transform: translateY(100vh) translateX(100px);
                opacity: 0;
            }
        }

        /* MOBILE RESPONSIVE STYLES */
        @media (max-width: 768px) {
            .header {
                padding: 8px 10px;
                flex-wrap: wrap;
            }

            .logo-group {
                margin-right: 10px;
            }

            .logo-group img {
                height: 24px;
                margin-right: 8px;
            }

            .search-container {
                max-width: 100%;
                width: 100%;
                order: 3;
                margin-top: 8px;
                margin-left: 0;
            }

            #search-input {
                padding: 6px 8px 6px 36px;
                font-size: 13px;
            }

            .search-icon {
                width: 18px;
                height: 18px;
            }

            .main-layout {
                display: flex;
                flex-direction: column;
                gap: 20px;
                margin-top: 15px;
            }

            .content {
                flex: 1;
            }

            .sidebar {
                flex: 1;
                min-width: 100%;
                position: static !important;
                top: auto !important;
                order: -1;
            }

            .post {
                display: flex;
                flex-direction: column;
                gap: 15px;
                padding: 15px;
                margin-bottom: 15px;
            }

            .post-media {
                width: 100%;
                height: 200px;
            }

            .post-body-wrap {
                flex: 1;
            }

            .post-title a {
                font-size: 20px;
            }

            .post-intro {
                font-size: 14px;
                line-height: 1.5;
            }

            .post-footer {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }

            .post-stats {
                width: 100%;
            }

            .post-tags {
                width: 100%;
                display: flex;
                flex-wrap: wrap;
                gap: 5px;
            }

            .post-tags a {
                font-size: 11px;
                padding: 2px 6px;
            }

            .container {
                padding: 0 8px;
            }

            .article-view {
                padding: 15px;
                margin-bottom: 15px;
            }

            .article-cover {
                max-height: 300px;
                margin-bottom: 15px;
            }

            .article-body p, .static-page-body p {
                font-size: 15px;
                line-height: 1.6;
                margin-bottom: 15px;
            }

            .footer {
                padding: 15px 10px;
                font-size: 12px;
            }

            .footer p {
                margin: 5px 0;
            }

            .footer a {
                margin: 0 5px;
            }

            .modal-content {
                width: 95%;
                margin: 20% auto;
                padding: 20px;
            }

            #managePostsModal .modal-content {
                margin: 10% auto;
            }

            .post-management-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }

            .management-actions {
                width: 100%;
                display: flex;
                gap: 5px;
            }

            .management-actions button {
                flex: 1;
                padding: 6px 8px;
                font-size: 11px;
            }

            .modal-content input[type="text"],
            .modal-content input[type="password"],
            .modal-content input[type="file"],
            .modal-content textarea {
                font-size: 16px;
            }

            .article-like-btn {
                font-size: 12px;
                padding: 6px 12px;
            }
        }

        @media (max-width: 480px) {
            .header {
                padding: 6px 8px;
            }

            .logo-group img {
                height: 20px;
                margin-right: 6px;
            }

            .post {
                padding: 10px;
                margin-bottom: 10px;
            }

            .post-media {
                height: 150px;
            }

            .post-title a {
                font-size: 16px;
            }

            .article-view {
                padding: 10px;
            }

            .container {
                padding: 0 5px;
            }

            .post-footer {
                font-size: 12px;
            }

            .footer {
                padding: 10px 5px;
                font-size: 11px;
            }

            .footer a {
                margin: 0 3px;
                display: inline;
            }

            .footer p {
                margin: 3px 0;
            }

            .modal-content {
                width: 98%;
                margin: 30% auto;
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <div id="snowflakes" class="snowflakes" style="z-index: 0;"></div>
    <div id="loader-overlay" class="loader-overlay" style="z-index: 9999;">
        <div class="loader-content">
            <div class="loader-pulse">
                <img src="logo.png" alt="Loading">
            </div>
        </div>
    </div>

    <div class="container" style="flex: 1; display: flex; flex-direction: column; position: relative; z-index: 10;">
        <header class="header">
            <div class="logo-group">
                <img src="logo.png" alt="Habr Logo" id="habr-logo" title="–ù–∞–∂–º–∏—Ç–µ 6 —Ä–∞–∑ –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞">
                <img src="assets/vpj.png" alt="VPJ Logo" id="vpj-logo" title="–ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ –≥–ª–∞–≤–Ω—É—é –ª–µ–Ω—Ç—É">
            </div>

            <nav class="header-nav">
            </nav>
            <div class="header-actions">
                <div class="search-container">
                    <img src="assets/search.png" class="search-icon" alt="–ü–æ–∏—Å–∫">
                    <input type="text" id="search-input" placeholder="–ü–æ–∏—Å–∫ –ø–æ —Å—Ç–∞—Ç—å—è–º..." oninput="filterPosts()">
                </div>
            </div>
        </header>

        <div class="main-content-wrap">
            <main class="main-layout">
                <div class="content" id="content-container">
                    </div>

                <aside class="sidebar" style="position: sticky; top: 70px;">
                    <div style="background-color: var(--dark-card); padding: 20px; border-radius: 4px; margin-bottom: 20px;">
                        <h3 style="margin-top: 0; color: var(--accent-white); border-bottom: 1px solid var(--border-color); padding-bottom: 10px;">üî• –ü–æ–ø—É–ª—è—Ä–Ω–æ–µ –∑–∞ 24 —á–∞—Å–∞</h3>
                        <div id="popular-articles-list" class="popular-list">
                            </div>
                    </div>
                </aside>
            </main>
        </div>
    </div>

    <div id="toast-notification" class="toast-notification">–°—Å—ã–ª–∫–∞ —Å—Ç–∞—Ç—å–∏ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞</div>

    <footer class="footer">
        <div class="container">
            <p>&copy; 2025 –û–û–û "–≤–ø–∏–∑–¥–µ". –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>
            <p>
                <a href="#page/rules" onclick="showStaticPage('rules'); return false;">–ö–æ–¥–µ–∫—Å VPJ</a> | 
                <a href="#page/privacy" onclick="showStaticPage('privacy'); return false;">–ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏</a> | 
                <a href="https://t.me/vpizdejournal_bot">–ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å –Ω–æ–≤–æ—Å—Ç—å</a> | 
                <a href="https://www.donationalerts.com/r/kraspers">–î–æ–Ω–∞—Ç –Ω–∞ –ø–∏–≤–æ</a>
            </p>
        </div>
    </footer>


    <div id="passwordModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="document.getElementById('passwordModal').style.display='none'">&times;</span>
            <h2>–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å</h2>
            <p>–ß—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å —Ä–µ–¥–∞–∫—Ç–æ—Ä, –≤–≤–µ–¥–∏—Ç–µ —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –ø–∞—Ä–æ–ª—å:</p>
            <input type="password" id="passwordInput" placeholder="–ü–∞—Ä–æ–ª—å">
            <button id="auth-btn">–í–æ–π—Ç–∏</button>
            <p id="auth-message" style="color: red; margin-top: 10px;"></p>
        </div>
    </div>

    <div id="createPostModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="document.getElementById('createPostModal').style.display='none'">&times;</span>
            <h2>–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π —Å—Ç–∞—Ç—å–∏</h2>
            <form id="post-form">
                <label for="post-author-input">–ò–º—è –∞–≤—Ç–æ—Ä–∞ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å @)</label>
                <input type="text" id="post-author-input" value="VPJ_Author" required>

                <label for="post-title-input">–ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç–∞—Ç—å–∏</label>
                <input type="text" id="post-title-input" required>

                <label for="post-image-file-input">–û–±–ª–æ–∂–∫–∞ (–∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞)</label>
                <input type="file" id="post-image-file-input" accept="image/*">

                <label for="post-intro-input">–ö—Ä–∞—Ç–∫–æ–µ –≤—Å—Ç—É–ø–ª–µ–Ω–∏–µ</label>
                <textarea id="post-intro-input" rows="3" required></textarea>

                <label for="post-text-input">–ü–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç —Å—Ç–∞—Ç—å–∏</label>
                <textarea id="post-text-input" rows="10" placeholder="–ó–¥–µ—Å—å –±—É–¥–µ—Ç –ø–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç —Å—Ç–∞—Ç—å–∏, –≤–∫–ª—é—á–∞—è –º–∞—Ç –∏ —é–º–æ—Ä" required></textarea>

                <label for="post-tags-input">–¢–µ–≥–∏ (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)</label>
                <input type="text" id="post-tags-input" placeholder="–º–∞—Ç, —é–º–æ—Ä, –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ">

                <div class="checkbox-group">
                    <input type="checkbox" id="post-popular-input">
                    <label for="post-popular-input" style="margin-top: 0; display: inline;">–î–æ–±–∞–≤–∏—Ç—å –≤ üî• –ü–æ–ø—É–ª—è—Ä–Ω–æ–µ –∑–∞ 24 —á–∞—Å–∞</label>
                </div>

                <button type="submit" id="publish-btn">–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å</button>
            </form>
        </div>
    </div>

    <div id="editPostModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="document.getElementById('editPostModal').style.display='none'">&times;</span>
            <h2>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç—å–∏ <span id="editing-post-id" style="display: none;"></span></h2>
            <form id="edit-post-form">
                <label for="edit-post-author-input">–ò–º—è –∞–≤—Ç–æ—Ä–∞ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å @)</label>
                <input type="text" id="edit-post-author-input" value="VPJ_Author" required>

                <label for="edit-post-title-input">–ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç–∞—Ç—å–∏</label>
                <input type="text" id="edit-post-title-input" required>

                <label for="edit-post-image-file-input">–û–±–ª–æ–∂–∫–∞ (–∑–∞–≥—Ä—É–∑–∫–∞ –Ω–æ–≤–æ–≥–æ —Ñ–∞–π–ª–∞, –∏–ª–∏ –æ—Å—Ç–∞–≤–∏—Ç—å –ø—É—Å—Ç—ã–º)</label>
                <input type="file" id="edit-post-image-file-input" accept="image/*">

                <label for="edit-post-intro-input">–ö—Ä–∞—Ç–∫–æ–µ –≤—Å—Ç—É–ø–ª–µ–Ω–∏–µ</label>
                <textarea id="edit-post-intro-input" rows="3" required></textarea>

                <label for="edit-post-text-input">–ü–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç —Å—Ç–∞—Ç—å–∏</label>
                <textarea id="edit-post-text-input" rows="10" placeholder="–ó–¥–µ—Å—å –±—É–¥–µ—Ç –ø–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç —Å—Ç–∞—Ç—å–∏, –≤–∫–ª—é—á–∞—è –º–∞—Ç –∏ —é–º–æ—Ä" required></textarea>

                <label for="edit-post-tags-input">–¢–µ–≥–∏ (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)</label>
                <input type="text" id="edit-post-tags-input" placeholder="–º–∞—Ç, —é–º–æ—Ä, –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ">

                <div class="checkbox-group">
                    <input type="checkbox" id="edit-post-popular-input">
                    <label for="edit-post-popular-input" style="margin-top: 0; display: inline;">–î–æ–±–∞–≤–∏—Ç—å –≤ üî• –ü–æ–ø—É–ª—è—Ä–Ω–æ–µ –∑–∞ 24 —á–∞—Å–∞</label>
                </div>

                <button type="submit" id="save-edit-btn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
            </form>
        </div>
    </div>

    <div id="managePostsModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="document.getElementById('managePostsModal').style.display='none'">&times;</span>
            <h2>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—å—è–º–∏ (–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ/–£–¥–∞–ª–µ–Ω–∏–µ)</h2>
            <ul id="post-management-list" class="post-management-list">
                </ul>
        </div>
    </div>


    <template id="article-template">
        <div class="article-view">
            <div class="article-cover">
                <img src="" alt="–û–±–ª–æ–∂–∫–∞ —Å—Ç–∞—Ç—å–∏" id="article-cover-img">
            </div>

            <div class="post-meta">
                <span><span id="article-date"></span> –≤ <span id="article-time"></span></span>
                <a href="#"><span id="article-author"></span></a><a href="#"></a>
            </div>

            <h1 style="color: var(--accent-white); font-size: 36px; margin-top: 10px; margin-bottom: 20px;" id="article-title"></h1>

            <div class="article-body">
                <p id="article-full-text"></p>
            </div>

            <div class="post-footer">
                <div class="post-stats">
                    <span id="article-views">üëÅ 0</span>
                    <button class="article-like-btn" id="article-like-btn">
                        ‚ù§Ô∏è <span id="article-like-count">0</span>
                    </button>
                    <button class="article-share-btn" id="article-share-btn" onclick="shareArticle()">
                        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92s2.92-1.31 2.92-2.92-1.31-2.92-2.92-2.92z"/></svg>
                    </button>
                </div>
                <div class="post-tags" id="article-tags">
                </div>
            </div>
        </div>
    </template>

    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
    <script>
        // –ü–∞—Ä–æ–ª–∏ –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
        let clickCount = 0;
        const TIME_TO_RESET = 24 * 60 * 60 * 1000; 
        let isNewYearMode = false;

        // New Year snow animation
        function createSnow() {
            const snowflakesContainer = document.getElementById('snowflakes');
            if (!snowflakesContainer) return;
            snowflakesContainer.innerHTML = '';
            
            for (let i = 0; i < 50; i++) {
                const snowflake = document.createElement('div');
                snowflake.classList.add('snowflake');
                snowflake.textContent = '‚ùÑ';
                snowflake.style.left = Math.random() * 100 + '%';
                snowflake.style.animationDuration = (Math.random() * 3 + 5) + 's';
                snowflake.style.animationDelay = Math.random() * 2 + 's';
                snowflakesContainer.appendChild(snowflake);
            }
        }

        function toggleNewYearMode(enable) {
            isNewYearMode = enable;
            const body = document.body;
            const vpjLogo = document.getElementById('vpj-logo');
            
            if (enable) {
                body.classList.add('new-year-theme');
                createSnow();
                if (vpjLogo) {
                    vpjLogo.src = 'assets/vpj-newyear.png';
                }
            } else {
                body.classList.remove('new-year-theme');
                const snowflakesContainer = document.getElementById('snowflakes');
                if (snowflakesContainer) {
                    snowflakesContainer.innerHTML = '';
                }
                if (vpjLogo) {
                    vpjLogo.src = 'assets/vpj.png';
                }
            }
        }

        const habrLogo = document.getElementById('habr-logo');
        const vpjLogo = document.getElementById('vpj-logo'); 
        const contentContainer = document.getElementById('content-container');
        const popularListContainer = document.getElementById('popular-articles-list');
        const passwordModal = document.getElementById('passwordModal');
        const passwordInput = document.getElementById('passwordInput');
        const authBtn = document.getElementById('auth-btn');
        const authMessage = document.getElementById('auth-message');
        const createPostModal = document.getElementById('createPostModal');
        const postForm = document.getElementById('post-form');
        const postAuthorInput = document.getElementById('post-author-input');
        const searchInput = document.getElementById('search-input'); 

        const managePostsModal = document.getElementById('managePostsModal');
        const postManagementList = document.getElementById('post-management-list');
        const editPostModal = document.getElementById('editPostModal');
        const editPostForm = document.getElementById('edit-post-form');

        let allPosts = [];
        const socket = io();
        const visitorId = localStorage.getItem('visitorId') || (() => {
            const id = 'v_' + Math.random().toString(36).substr(2, 9);
            localStorage.setItem('visitorId', id);
            return id;
        })();

        // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –Ω–æ–≤–æ–≥–æ–¥–Ω—é—é —Ç–µ–º—É –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        async function restoreThemeOnLoad() {
            try {
                const response = await fetch('/api/theme');
                const data = await response.json();
                if (data.isNewYear) {
                    toggleNewYearMode(true);
                }
            } catch (e) {
                console.error('Error restoring theme:', e);
            }
        }

        restoreThemeOnLoad();

        function hideLoader() {
            const loaderOverlay = document.getElementById('loader-overlay');
            if (loaderOverlay) {
                loaderOverlay.classList.add('hidden');
            }
        }

        socket.on('posts-updated', (posts) => {
            allPosts = posts;
            hideLoader();
            const hash = window.location.hash;
            const matchPost = hash.match(/^#post\/(\d+)/);
            if (matchPost) {
                renderArticle(parseInt(matchPost[1]));
            } else if (!hash.startsWith('#page/')) {
                renderFeed();
            }
            renderPopularArticles();
        });

        socket.on('post-stats-updated', (data) => {
            const post = allPosts.find(p => p.id === data.id);
            if (post) {
                post.views = data.views;
                post.likes = data.likes;
                updateStatsInDOM(data.id, data.views, data.likes);
            }
        });

        socket.on('theme-updated', (data) => {
            toggleNewYearMode(data.isNewYear);
        });

        function updateStatsInDOM(postId, views, likes) {
            const postEl = document.querySelector(`.post[data-post-id="${postId}"]`);
            if (postEl) {
                const stats = postEl.querySelector('.post-stats');
                if (stats) {
                    const spans = stats.querySelectorAll('span');
                    if (spans[0]) spans[0].textContent = `üëÅ ${views}`;
                    if (spans[1]) spans[1].innerHTML = `‚ù§Ô∏è ${likes}`;
                }
            }
            const articleViews = document.getElementById('article-views');
            const articleLikes = document.getElementById('article-like-count');
            if (articleViews) articleViews.textContent = `üëÅ ${views}`;
            if (articleLikes) articleLikes.textContent = likes;
        }

        function getPosts() {
            return allPosts;
        }

        function getPopularPosts() {
            return allPosts.filter(post => post.isPopular);
        }

        function getReadPosts() {
            const readPosts = localStorage.getItem('readPosts');
            return readPosts ? JSON.parse(readPosts) : [];
        }

        function setReadPost(postId) {
            let readPosts = getReadPosts();
            if (!readPosts.includes(postId)) {
                readPosts.push(postId);
                localStorage.setItem('readPosts', JSON.stringify(readPosts));
                return true;
            }
            return false;
        }

        // --- 2. –ö–æ–Ω—Ç–µ–Ω—Ç —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Å—Ç—Ä–∞–Ω–∏—Ü ---
        const staticPages = {
            rules: {
                title: "–ö–æ–¥–µ–∫—Å VPJ: –ü—Ä–∞–≤–∏–ª–∞ –∏ –ü—Ä–∏–Ω—Ü–∏–ø—ã",
                content: `
                    <p>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ ¬´VPizde Journal¬ª. –≠—Ç–æ —Å–æ–æ–±—â–µ—Å—Ç–≤–æ —Å–æ–∑–¥–∞–Ω–æ –¥–ª—è –∫—Ä–µ–∞—Ç–∏–≤–∞, —é–º–æ—Ä–∞ –∏ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–π –∏—Ä–æ–Ω–∏–∏. –ß—Ç–æ–±—ã –Ω–∞–º –≤—Å–µ–º –±—ã–ª–æ —Ö–æ—Ä–æ—à–æ, —Å–ª–µ–¥—É–π—Ç–µ —ç—Ç–∏–º –ø—Ä–æ—Å—Ç—ã–º, –Ω–æ –≤–∞–∂–Ω—ã–º –ø—Ä–∞–≤–∏–ª–∞–º:</p>
                    <ul>
                        <li>1. <strong>–ö—Ä–µ–∞—Ç–∏–≤–Ω–∞—è —Å–≤–æ–±–æ–¥–∞.</strong> –ú—ã –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤—É–µ–º —Å–∞—Ç–∏—Ä—É, —á–µ—Ä–Ω—ã–π —é–º–æ—Ä, –º–µ–º—ã –∏ –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –≤–∑–≥–ª—è–¥ –Ω–∞ –≤–µ—â–∏. –ï—Å–ª–∏ —ç—Ç–æ —Å–º–µ—à–Ω–æ –∏–ª–∏ —É–º–Ω–æ ‚Äî —ç—Ç–æ –≤ VPJ.</li>
                        <li>2. <strong>–ú–∞—Ç –∏ —ç–∫—Å–ø—Ä–µ—Å—Å–∏—è.</strong> –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –Ω–µ—Ü–µ–Ω–∑—É—Ä–Ω–æ–π –ª–µ–∫—Å–∏–∫–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–æ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ –≤—ã—Ä–∞–∂–µ–Ω–∏—è –∏–ª–∏ —é–º–æ—Ä–∞, –Ω–æ –Ω–µ –¥–æ–ø—É—Å–∫–∞–µ—Ç—Å—è –¥–ª—è –ø—Ä—è–º–æ–≥–æ –∏ –Ω–µ–æ–±–æ—Å–Ω–æ–≤–∞–Ω–Ω–æ–≥–æ –æ—Å–∫–æ—Ä–±–ª–µ–Ω–∏—è –¥—Ä—É–≥–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–ª–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏–∏. –ë—É–¥—å—Ç–µ –æ—Å—Ç—Ä–æ—É–º–Ω—ã, –∞ –Ω–µ –ø—Ä–æ—Å—Ç–æ –≥—Ä—É–±—ã.</li>
                        <li>3. <strong>–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–∏–≤–Ω–∞—è –∫—Ä–∏—Ç–∏–∫–∞.</strong> –ï—Å–ª–∏ –≤—ã –∫—Ä–∏—Ç–∏–∫—É–µ—Ç–µ —Å—Ç–∞—Ç—å—é, –ø—É—Å—Ç—å –≤–∞—à–∞ –∫—Ä–∏—Ç–∏–∫–∞ –±—É–¥–µ—Ç –ø–æ —Å—É—â–µ—Å—Ç–≤—É –∏ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∞ –Ω–∞ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ, –∞ –Ω–µ –Ω–∞ –ª–∏—á–Ω–æ—Å—Ç—å –∞–≤—Ç–æ—Ä–∞.</li>
                        <li>4. <strong>–ó–∞–ø—Ä–µ—Ç –Ω–∞ –ø–æ–ª–∏—Ç–∏–∫—É –∏ —Ä–æ–∑–Ω—å.</strong> –°—Ç—Ä–æ–≥–æ –∑–∞–ø—Ä–µ—â–µ–Ω—ã –º–∞—Ç–µ—Ä–∏–∞–ª—ã, —Ä–∞–∑–∂–∏–≥–∞—é—â–∏–µ –º–µ–∂–Ω–∞—Ü–∏–æ–Ω–∞–ª—å–Ω—É—é, —Ä–µ–ª–∏–≥–∏–æ–∑–Ω—É—é –∏–ª–∏ –ø–æ–ª–∏—Ç–∏—á–µ—Å–∫—É—é —Ä–æ–∑–Ω—å, –∞ —Ç–∞–∫–∂–µ –ø—Ä—è–º–∞—è –ø—Ä–æ–ø–∞–≥–∞–Ω–¥–∞. –ú—ã –∑–¥–µ—Å—å —Ä–∞–¥–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞, –∞ –Ω–µ —Ä–∞–¥–∏ –≤–æ–π–Ω—ã.</li>
                        <li>5. <strong>–£–≤–∞–∂–µ–Ω–∏–µ –∫ –∫–æ–Ω—Ç–µ–Ω—Ç—É.</strong> –£–∫–∞–∑—ã–≤–∞–π—Ç–µ –¥–æ—Å—Ç–æ–≤–µ—Ä–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏, –µ—Å–ª–∏ —ç—Ç–æ –Ω–µ —á–∏—Å—Ç—ã–π –≤—ã–º—ã—Å–µ–ª. –ü–ª–∞–≥–∏–∞—Ç –∑–∞–ø—Ä–µ—â–µ–Ω.</li>
                        <li>6. <strong>–†–µ—à–µ–Ω–∏–µ —Å–ø–æ—Ä–æ–≤.</strong> –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏—è VPJ –æ—Å—Ç–∞–≤–ª—è–µ—Ç –∑–∞ —Å–æ–±–æ–π –ø—Ä–∞–≤–æ –≤–Ω–æ—Å–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –ö–æ–¥–µ–∫—Å –∏ –ø—Ä–∏–Ω–∏–º–∞—Ç—å –æ–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –ø–æ –ª—é–±—ã–º —Å–ø–æ—Ä–Ω—ã–º —Å–∏—Ç—É–∞—Ü–∏—è–º.</li>
                    </ul>
                    <p>–ù–∞—Ä—É—à–µ–Ω–∏–µ –ö–æ–¥–µ–∫—Å–∞ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ —É–¥–∞–ª–µ–Ω–∏—é –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –∏ –≤—Ä–µ–º–µ–Ω–Ω–æ–π –∏–ª–∏ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–π –±–ª–æ–∫–∏—Ä–æ–≤–∫–µ –∞–∫–∫–∞—É–Ω—Ç–∞.</p>
                `
            },
            privacy: {
                title: "–ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏",
                content: `
                    <p>–ù–∞—Å—Ç–æ—è—â–∞—è –ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏ –æ–ø–∏—Å—ã–≤–∞–µ—Ç, –∫–∞–∫ –û–û–û "–≤–ø–∏–∑–¥–µ" —Å–æ–±–∏—Ä–∞–µ—Ç, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∏ –∑–∞—â–∏—â–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é, –ø–æ–ª—É—á–µ–Ω–Ω—É—é –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –≤–µ–±-—Å–∞–π—Ç–∞ VPizde Journal. –î–∞–Ω–Ω—ã–π —Ä–µ—Å—É—Ä—Å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–µ—Ä–≤–µ—Ä–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É Node.js –∏ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö.</p>

                    <h3>1. –°–±–æ—Ä –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏</h3>
                    <ul>
                        <li><strong>–î–∞–Ω–Ω—ã–µ, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ–º—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º:</strong> –ú—ã —Å–æ–±–∏—Ä–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é, –∫–æ—Ç–æ—Ä—É—é –í—ã –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç–µ –Ω–∞–ø—Ä—è–º—É—é –ø—Ä–∏ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ —Å—Ç–∞—Ç–µ–π (–∏–º—è –∞–≤—Ç–æ—Ä–∞, —Ç–µ–∫—Å—Ç, –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è) –∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–∏ —Å –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º (–ª–∞–π–∫–∏, –ø—Ä–æ—Å–º–æ—Ç—Ä—ã). –≠—Ç–∏ –¥–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –Ω–∞—à–µ–π –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.</li>
                        <li><strong>–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ:</strong> –ù–∞—à —Å–µ—Ä–≤–µ—Ä (Node.js) –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é, –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º—É—é –í–∞—à–∏–º –±—Ä–∞—É–∑–µ—Ä–æ–º, –≤–∫–ª—é—á–∞—è IP-–∞–¥—Ä–µ—Å, —Ç–∏–ø –±—Ä–∞—É–∑–µ—Ä–∞, –≤—Ä–µ–º—è –¥–æ—Å—Ç—É–ø–∞, –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Å–µ—Å—Å–∏–∏ –∏ –¥–∞–Ω–Ω—ã–µ –æ–± –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –Ω–∞ —Å–∞–π—Ç–µ. –≠—Ç–∏ –¥–∞–Ω–Ω—ã–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏, –∞–Ω–∞–ª–∏–∑–∞ —Ç—Ä–∞—Ñ–∏–∫–∞ –∏ —É–ª—É—á—à–µ–Ω–∏—è —Å–µ—Ä–≤–∏—Å–∞.</li>
                    </ul>

                    <h3>2. –•—Ä–∞–Ω–µ–Ω–∏–µ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å</h3>
                    <p>–í—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è —Ö—Ä–∞–Ω–∏—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ Node.js —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –Ω–∞–¥–µ–∂–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–∞–∑–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö. –ú—ã –ø—Ä–∏–º–µ–Ω—è–µ–º —Ä–∞–∑—É–º–Ω—ã–µ –∏ –∞–¥–µ–∫–≤–∞—Ç–Ω—ã–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∏ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–æ–Ω–Ω—ã–µ –º–µ—Ä—ã –¥–ª—è –∑–∞—â–∏—Ç—ã –í–∞—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö –æ—Ç –Ω–µ—Å–∞–Ω–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞, –∏–∑–º–µ–Ω–µ–Ω–∏—è, —Ä–∞—Å–∫—Ä—ã—Ç–∏—è –∏–ª–∏ —É–Ω–∏—á—Ç–æ–∂–µ–Ω–∏—è. –û–¥–Ω–∞–∫–æ, –Ω–∏ –æ–¥–∏–Ω –º–µ—Ç–æ–¥ –ø–µ—Ä–µ–¥–∞—á–∏ –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ –ò–Ω—Ç–µ—Ä–Ω–µ—Ç –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –Ω–∞ 100% –±–µ–∑–æ–ø–∞—Å–Ω—ã–º.</p>

                    <h3>3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Cookie</h3>
                    <p>–ú—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ñ–∞–π–ª—ã cookie –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ —Å–±–æ—Ä–∞ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö –æ –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç–∏. –í—ã –º–æ–∂–µ—Ç–µ –æ—Ç–∫–ª—é—á–∏—Ç—å cookie –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö —Å–≤–æ–µ–≥–æ –±—Ä–∞—É–∑–µ—Ä–∞, –Ω–æ —ç—Ç–æ –º–æ–∂–µ—Ç –ø–æ–≤–ª–∏—è—Ç—å –Ω–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å —Å–∞–π—Ç–∞.</p>

                    <h3>4. –†–∞—Å–∫—Ä—ã—Ç–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ —Ç—Ä–µ—Ç—å–∏–º –ª–∏—Ü–∞–º</h3>
                    <p>–ú—ã –Ω–µ –ø—Ä–æ–¥–∞–µ–º, –Ω–µ –æ–±–º–µ–Ω–∏–≤–∞–µ–º –∏ –Ω–µ –ø–µ—Ä–µ–¥–∞–µ–º –í–∞—à—É –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é —Ç—Ä–µ—Ç—å–∏–º –ª–∏—Ü–∞–º –±–µ–∑ –í–∞—à–µ–≥–æ —è–≤–Ω–æ–≥–æ —Å–æ–≥–ª–∞—Å–∏—è, –∑–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ–º —Å–ª—É—á–∞–µ–≤, –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ–Ω–Ω—ã—Ö –∑–∞–∫–æ–Ω–æ–º.</p>

                    <h3>5. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã–º–∏</h3>
                    <p>–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –∏–º–µ—é—Ç –ø–æ–ª–Ω—ã–µ –ø—Ä–∞–≤–∞ –Ω–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–ª–∏ —É–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–µ–π –µ—Å–ª–∏ –æ–Ω–∞ –Ω–∞—Ä—É—à–∞–µ—Ç –∫–æ–¥–µ–∫—Å –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã.</p>

                    <p>–ü—Ä–æ–¥–æ–ª–∂–∞—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–∞–π—Ç VPizde Journal, –í—ã —Å–æ–≥–ª–∞—à–∞–µ—Ç–µ—Å—å —Å —É—Å–ª–æ–≤–∏—è–º–∏ –¥–∞–Ω–Ω–æ–π –ü–æ–ª–∏—Ç–∏–∫–∏ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏.</p>
                `
            }
        };

        function renderStaticPageView(pageId) {
            const page = staticPages[pageId];
            if (!page) return;

            contentContainer.innerHTML = `
                <div class="article-view">
                    <h1 style="color: var(--accent-white); font-size: 36px; margin-bottom: 25px;">${page.title}</h1>
                    <div class="static-page-body" style="color: var(--text-light);">
                        ${page.content}
                    </div>
                </div>
            `;
            window.scrollTo(0, 0);

            popularListContainer.innerHTML = '';
            renderPopularArticles(); 
        }

        window.showStaticPage = function(pageId) {
            history.pushState(null, null, `#page/${pageId}`);
            renderStaticPageView(pageId);
        }

        // --- 3. –õ–æ–≥–∏–∫–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ª–µ–Ω—Ç—ã –∏ —Å—Ç–∞—Ç–µ–π ---

        function renderFeed(filteredPosts = getPosts()) {
            if (searchInput.value.trim() === '') {
                 if (!window.location.hash.startsWith('#page/')) {
                    history.pushState(null, null, 'index.html');
                 }
            }

            contentContainer.innerHTML = '<h1 style="color: var(--accent-white); font-size: 32px; margin-bottom: 25px;">–õ–µ–Ω—Ç–∞</h1>';

            const posts = filteredPosts;
            const query = searchInput.value ? searchInput.value.trim() : ''; 

            if (posts.length === 0) {
                if (query === '') {
                    contentContainer.innerHTML += '<p style="color: var(--text-secondary);">–ü–æ–∫–∞ —á—Ç–æ –∑–¥–µ—Å—å –ø—É—Å—Ç–æ.</p>';
                } else {
                    contentContainer.innerHTML += `
                        <div class="not-found">
                            <img src="assets/not_found.png" alt="–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ">
                            <h2 style="color: var(--text-light);">–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</h2>
                            <p style="color: var(--text-secondary);">–ü–æ –∑–∞–ø—Ä–æ—Å—É "${query}" –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.</p>
                        </div>
                    `;
                }
            }

            posts.forEach(post => {
                const tagsHtml = post.tags.split(',').map(tag => {
                    const cleanTag = tag.trim().replace(/^#/, '');
                    return cleanTag ? `<a href="#" onclick="event.preventDefault(); filterPostsByTag('${cleanTag}')">#${cleanTag}</a>` : '';
                }).join('\n');

                const postLink = `#post/${post.id}`;

                // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –ª–∞–π–∫–∏ –≤ –ª–µ–Ω—Ç–µ
                const likesCount = post.likes || 0;
                const likedClass = post.isLiked ? 'color: #ff4757;' : '';

                // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Ä–µ–∞–ª—å–Ω—ã–µ –ø—Ä–æ—Å–º–æ—Ç—Ä—ã –≤ –ª–µ–Ω—Ç–µ
                const viewsCount = post.views || 0;

                const postHtml = `
                    <div class="post" data-post-id="${post.id}" onclick="showPostDetails('${post.id}')">
                        <div class="post-media">
                            <img src="${post.imageUrl}" alt="–û–±–ª–æ–∂–∫–∞ —Å—Ç–∞—Ç—å–∏">
                        </div>
                        <div class="post-body-wrap">
                            <div>
                                <div class="post-meta">
                                    <span>${post.date} –≤ ${post.time}</span>
                                    <a href="#">${post.author}</a><a href="#">${post.hub || ''}</a>
                                </div>
                                <h2 class="post-title">
                                    <a href="${postLink}" onclick="event.preventDefault(); showPostDetails('${post.id}')">${post.title}</a>
                                </h2>
                            </div>
                            <div class="post-intro">
                                <p>${post.intro}</p>
                            </div>
                            <div class="post-footer">
                                <div class="post-stats">
                                    <span>üëÅ ${viewsCount}</span> 
                                    <span style="${likedClass}">‚ù§Ô∏è ${likesCount}</span>
                                </div>
                                <div class="post-tags">
                                    ${tagsHtml}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                contentContainer.innerHTML += postHtml;
            });

            if (query === '') {
                renderPopularArticles();
            } else {
                popularListContainer.innerHTML = ''; 
            }
        }

        function renderPopularArticles() {
            popularListContainer.innerHTML = '';
            const popularPosts = getPopularPosts();

            if (popularPosts.length === 0) {
                popularListContainer.innerHTML = '<p style="font-size: 14px; color: var(--text-secondary);">–ü–æ–ø—É–ª—è—Ä–Ω—ã—Ö —Å—Ç–∞—Ç–µ–π –ø–æ–∫–∞ –Ω–µ—Ç.</p>';
                return;
            }

            popularPosts.forEach((post, index) => {
                const link = document.createElement('a');
                link.href = `#post/${post.id}`;
                link.textContent = `${index + 1}. ${post.title}`;
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    showPostDetails(post.id);
                });
                popularListContainer.appendChild(link);
            });
        }

        function renderArticle(postId) {
            const posts = getPosts();
            const post = posts.find(p => p.id == postId);

            if (!post) {
                contentContainer.innerHTML = '<h1 class="article-view" style="color: var(--text-light); text-align: center;">404: –°—Ç–∞—Ç—å—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞</h1>';
                return;
            }

            const postIDInt = parseInt(postId);
            if (setReadPost(postIDInt)) {
                fetch(`/api/posts/${postId}/view`, { method: 'POST' });
            }

            const template = document.getElementById('article-template').content.cloneNode(true);

            template.querySelector('#article-cover-img').src = post.imageUrl;
            template.querySelector('#article-title').textContent = post.title;
            template.querySelector('#article-date').textContent = post.date;
            template.querySelector('#article-time').textContent = post.time;
            template.querySelector('#article-author').textContent = post.author;

            template.querySelector('#article-views').textContent = `üëÅ ${post.views || 0}`;

            const likeBtn = template.querySelector('#article-like-btn');
            const likeCountSpan = template.querySelector('#article-like-count');

            likeCountSpan.textContent = post.likes || 0;
            const isLiked = post.likedBy && post.likedBy.includes(visitorId);
            if (isLiked) {
                likeBtn.classList.add('liked');
            }

            likeBtn.onclick = function() {
                toggleLike(post.id, likeBtn, likeCountSpan);
            };

            const fullTextContent = (post.fullText || post.intro).split('\n').map(p => `<p>${p}</p>`).join('');
            template.querySelector('#article-full-text').innerHTML = fullTextContent;

            const tagsHtml = post.tags.split(',').map(tag => {
                const cleanTag = tag.trim().replace(/^#/, '');
                return cleanTag ? `<a href="#" onclick="event.preventDefault(); filterPostsByTag('${cleanTag}')">#${cleanTag}</a>` : '';
            }).join('\n');
            template.querySelector('#article-tags').innerHTML = tagsHtml;

            contentContainer.innerHTML = '';
            contentContainer.appendChild(template);
            window.scrollTo(0, 0); 

            searchInput.value = '';
            popularListContainer.innerHTML = '';

            history.pushState(null, null, `#post/${postId}`);
        }

        async function toggleLike(postId, btnElement, countSpan) {
            try {
                const response = await fetch(`/api/posts/${postId}/like`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ visitorId })
                });
                const data = await response.json();
                countSpan.textContent = data.likes;
                if (data.isLiked) {
                    btnElement.classList.add('liked');
                } else {
                    btnElement.classList.remove('liked');
                }
            } catch (e) {
                console.error('Error toggling like:', e);
            }
        }

        window.shareArticle = function() {
            const url = window.location.href;
            navigator.clipboard.writeText(url).then(() => {
                const toast = document.getElementById('toast-notification');
                toast.classList.add('show');
                setTimeout(() => {
                    toast.classList.remove('show');
                }, 3000);
            }).catch(err => {
                console.error('Failed to copy:', err);
            });
        }

        // --- 4. –õ–æ–≥–∏–∫–∞ URL –∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ ---

        window.showPostDetails = function(postId) {
            renderArticle(postId);
        }

        window.onpopstate = function(event) {
            handleURLChange();
        };

        function handleURLChange() {
            const hash = window.location.hash;

            const matchPost = hash.match(/^#post\/(\d+)/);
            const matchPage = hash.match(/^#page\/(\w+)/);

            if (matchPost) {
                const postId = parseInt(matchPost[1]);
                renderArticle(postId);
            } else if (matchPage) {
                const pageId = matchPage[1];
                renderStaticPageView(pageId);
            } else {
                renderFeed(); 
            }
        }

        // --- 5. –õ–æ–≥–∏–∫–∞ –ø–æ–∏—Å–∫–∞ ---

        window.filterPosts = function() {
            history.replaceState(null, null, 'index.html');

            const query = searchInput.value.toLowerCase().trim();
            const allPosts = getPosts();

            if (query === '') {
                renderFeed(allPosts); 
                return;
            }

            const filtered = allPosts.filter(post => 
                post.title.toLowerCase().includes(query) ||
                (post.intro ? post.intro.toLowerCase().includes(query) : false) ||
                (post.fullText ? post.fullText.toLowerCase().includes(query) : false) ||
                post.tags.toLowerCase().includes(query)
            );

            renderFeed(filtered); 
        }

        window.filterPostsByTag = function(tag) {
            searchInput.value = tag;
            filterPosts();
        }

        // --- 6. –õ–æ–≥–∏–∫–∞ —Å–∫—Ä—ã—Ç–æ–≥–æ –≤—Ö–æ–¥–∞ ---

        habrLogo.addEventListener('click', () => {
            clickCount++;
            if (clickCount >= 6) {
                passwordModal.style.display = 'block';
                clickCount = 0; 
            }
        });

        vpjLogo.addEventListener('click', (e) => {
            e.preventDefault();
            searchInput.value = ''; 
            history.pushState(null, null, 'index.html'); 
            renderFeed(); 
        });

        authBtn.addEventListener('click', async () => {
            try {
                const response = await fetch('/api/auth', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ password: passwordInput.value })
                });
                const data = await response.json();
                
                if (data.role === 'editor') {
                    authMessage.textContent = '–£—Å–ø–µ—à–Ω–æ!';
                    passwordModal.style.display = 'none';
                    createPostModal.style.display = 'block';
                    passwordInput.value = '';
                } else if (data.role === 'admin') {
                    authMessage.textContent = '–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å!';
                    passwordModal.style.display = 'none';
                    passwordInput.value = '';
                    openManagePostsModal();
                } else if (data.themeToggled) {
                    authMessage.textContent = data.isNewYear ? '–ù–æ–≤—ã–π –≥–æ–¥ –≤–∫–ª—é—á—ë–Ω! üéÑ' : '–í–µ—Ä–Ω—É–ª–∏—Å—å –≤ –æ–±—ã—á–Ω—ã–π —Ä–µ–∂–∏–º!';
                    passwordModal.style.display = 'none';
                    passwordInput.value = '';
                    toggleNewYearMode(data.isNewYear);
                } else {
                    authMessage.textContent = '–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å.';
                }
            } catch (e) {
                authMessage.textContent = '–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞.';
            }
        });

        // --- 7. –õ–æ–≥–∏–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ—Å—Ç–∞ ---

        postForm.addEventListener('submit', (e) => {
            e.preventDefault();

            const fileInput = document.getElementById('post-image-file-input');
            const file = fileInput.files[0];

            if (file) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    savePostData(event.target.result); 
                };
                reader.readAsDataURL(file);
            } else {
                savePostData("https://via.placeholder.com/250x150?text=–û–±–ª–æ–∂–∫–∞+VPJ");
            }
        });

        async function savePostData(imageUrl) {
            const date = new Date().toLocaleDateString('ru-RU', {day: '2-digit', month: '2-digit', year: 'numeric'});
            const time = new Date().toLocaleTimeString('ru-RU', {hour: '2-digit', minute: '2-digit'});

            const rawAuthor = postAuthorInput.value.trim().replace(/^@/, '');
            const authorWithAt = `@${rawAuthor}`;

            const isPopular = document.getElementById('post-popular-input').checked;

            const newPost = {
                title: document.getElementById('post-title-input').value,
                author: authorWithAt,
                imageUrl: imageUrl,
                intro: document.getElementById('post-intro-input').value,
                fullText: document.getElementById('post-text-input').value,
                tags: document.getElementById('post-tags-input').value || '–∞–≤—Ç–æ—Ä—Å–∫–∏–π –ø–æ—Å—Ç',
                date: date,
                time: time,
                hub: '',
                isPopular: isPopular
            };

            try {
                await fetch('/api/posts', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(newPost)
                });
            } catch (e) {
                console.error('Error creating post:', e);
            }

            postForm.reset();
            postAuthorInput.value = 'VPJ_Author'; 
            createPostModal.style.display = 'none';
        }

        // --- 8. –ù–û–í–ê–Ø –õ–û–ì–ò–ö–ê –£–ü–†–ê–í–õ–ï–ù–ò–Ø –°–¢–ê–¢–¨–Ø–ú–ò ---

        function openManagePostsModal() {
            renderManagementList();
            managePostsModal.style.display = 'block';
        }

        function renderManagementList() {
            postManagementList.innerHTML = '';
            const allPosts = getPosts().reverse(); // –°–Ω–∞—á–∞–ª–∞ —Å—Ç–∞—Ä—ã–µ, —á—Ç–æ–±—ã –≤–∏–¥–µ—Ç—å, —á—Ç–æ —É–¥–∞–ª—è—Ç—å

            if (allPosts.length === 0) {
                postManagementList.innerHTML = '<li style="color: var(--text-secondary);">–°—Ç–∞—Ç–µ–π –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–µ—Ç.</li>';
                return;
            }

            allPosts.forEach(post => {
                const li = document.createElement('li');
                li.className = 'post-management-item';
                li.innerHTML = `
                    <span class="post-management-title">${post.id} | ${post.title}</span>
                    <div class="management-actions">
                        <button class="edit-btn" onclick="openEditPostModal(${post.id})">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                        <button class="delete-btn" onclick="deletePost(${post.id})">–£–¥–∞–ª–∏—Ç—å</button>
                    </div>
                `;
                postManagementList.appendChild(li);
            });
        }

        window.deletePost = async function(postId) {
            if (confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ç—å—é —Å ID: ${postId}?`)) {
                try {
                    await fetch(`/api/posts/${postId}`, { method: 'DELETE' });
                    renderManagementList();
                    const hash = window.location.hash;
                    const matchPost = hash.match(/^#post\/(\d+)/);
                    if (matchPost && parseInt(matchPost[1]) == postId) {
                        history.pushState(null, null, 'index.html');
                    }
                } catch (e) {
                    console.error('Error deleting post:', e);
                }
            }
        }

        window.openEditPostModal = function(postId) {
            managePostsModal.style.display = 'none';
            editPostModal.style.display = 'block';

            const post = getPosts().find(p => p.id == postId);
            if (!post) {
                alert('–û—à–∏–±–∫–∞: –°—Ç–∞—Ç—å—è –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞.');
                editPostModal.style.display = 'none';
                return;
            }

            // –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ñ–æ—Ä–º—ã
            document.getElementById('editing-post-id').textContent = postId; // –•—Ä–∞–Ω–∏–º ID
            document.getElementById('edit-post-author-input').value = post.author.replace(/^@/, '');
            document.getElementById('edit-post-title-input').value = post.title;
            document.getElementById('edit-post-intro-input').value = post.intro;
            document.getElementById('edit-post-text-input').value = post.fullText;
            document.getElementById('edit-post-tags-input').value = post.tags;
            document.getElementById('edit-post-popular-input').checked = post.isPopular;
        }

        editPostForm.addEventListener('submit', (e) => {
            e.preventDefault();

            const postId = parseInt(document.getElementById('editing-post-id').textContent);

            const fileInput = document.getElementById('edit-post-image-file-input');
            const file = fileInput.files[0];

            const updatePost = async (imageUrl) => {
                const rawAuthor = document.getElementById('edit-post-author-input').value.trim().replace(/^@/, '');
                const authorWithAt = `@${rawAuthor}`;
                const isPopular = document.getElementById('edit-post-popular-input').checked;

                const updatedData = {
                    title: document.getElementById('edit-post-title-input').value,
                    author: authorWithAt,
                    intro: document.getElementById('edit-post-intro-input').value,
                    fullText: document.getElementById('edit-post-text-input').value,
                    tags: document.getElementById('edit-post-tags-input').value || '–∞–≤—Ç–æ—Ä—Å–∫–∏–π –ø–æ—Å—Ç',
                    isPopular: isPopular
                };

                if (imageUrl) {
                    updatedData.imageUrl = imageUrl;
                }

                try {
                    await fetch(`/api/posts/${postId}`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(updatedData)
                    });
                } catch (e) {
                    console.error('Error updating post:', e);
                }

                editPostModal.style.display = 'none';
                editPostForm.reset();
                openManagePostsModal();
            };

            if (file) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    updatePost(event.target.result); 
                };
                reader.readAsDataURL(file);
            } else {
                updatePost(null);
            }
        });

        window.onload = () => {
            handleURLChange(); 
        };
    </script>
</body>
</html>